{% extends 'base.html' %}

{% block content %}
<main id="main">
    <!-- Header -->
    <header id="header">
        <h1>Socialize</h1>
        
        {% if g.user %}
        <h4><a href="{{ url_for('socialize.profile')}}"> {{ g.user['username'] }} </a></h4>
        <ul class="icons">
            {% if request.endpoint == url_for('socialize.index') %}
            <li>
                <a href="{{ url_for('socialize.user_feed')}}"> Feed </a>
            </li>
            {% else %}
            <li>
                <a href="{{ url_for('socialize.index')}}"> Trending </a>
            </li>
            {% endif %}
            <li>
                <a href="{{ url_for('socialize.create') }}"> Create </a>
            </li>
            <li>
                <a href="{{ url_for('socialize.connection')}}"> Connect </a>
            </li>
            <li>
                <a href="{{ url_for('auth.logout') }}"> Logout </a>
            </li>
        </ul>
        {% else %}
        <ul class="icons">
            <li>
            <a href="{{ url_for('auth.login') }}"> Login </a>
            </li>
        </ul>
        {% endif %}
    </header>
    
    <!-- Content -->
    <section id="thumbnails">
        {% for post in posts %}
        <article>
            <a class="thumbnail" href="{{ url_for('static', filename='images/') }}{{ post['image_url'] }}" data-position="left center">
            <img
                src="{{ url_for('static', filename='images/') }}{{ post['image_url'] }}"
                alt="{{ post['image_caption'] }}"
            />
            </a>
            <h2>by {{ post['post_user_id'] }} on {{ post['created'].strftime('%Y-%m-%d') }}</h2>
            <p>{{ post['image_caption'] }}</p>
            
            {% for x in post : %}
                <h1>{{ x }}</h1>
            {% endfor %}

            <ul class="icons">
                <li>
                    {% if post[-1] != None : %}
                        <button style="color : green;" onclick="
                                like('{{ post['post_id'] }}/{{ post['post_user_id'] }}')">
                          <!-- onclick=`like("{{ url_for('socialize.like', post_id=post['post_id'], post_user_id=post['post_user_id'], action='like') }}")` -->
                            <i class="fas fa-heart"></i>
                        </button>
                    {% else %}
                        <button onclick="
                                like('{{ post['post_id'] }}/{{ post['post_user_id'] }}')">
                          <!-- onclick=`like("{{ url_for('socialize.like', post_id=post['post_id'], post_user_id=post['post_user_id'], action='like') }}")` -->
                            <i class="fas fa-heart"></i>
                        </button>
                    {% endif %}
                </li>
                <li>
                    <a href="/comment/{{ post['post_id'] }}/{{ post['post_user_id'] }}">
                        <i class="fas fa-comment"></i>
                    </a>
                </li>
                <li>
                    <button
                      onclick="share('{{ post['image_url']|safe }}/{{ post['image_caption']|safe }}')"
                    >
                      <!-- onclick=`share("{{ url_for('socialize.share', image_url=post['image_url'], caption=post['image_caption']) }}")` -->
                      <i class="fas fa-share"></i>
                    </button>
                </li>
            </ul>

        </article>
        {% endfor %}
    </section>
</main>

<!-- Scripts -->
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>

<script>
function like(like_url) {
    var xhttp = new XMLHttpRequest();
    /* xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            document.getElementById("demo").innerHTML = this.responseText;
        }
    }; */
    console.log(like_url)
    xhttp.open("GET", `/like/${like_url}`, true);
    xhttp.send();
}
function share(share_url) {
    var xhttp = new XMLHttpRequest();
    /* xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            document.getElementById("demo").innerHTML = this.responseText;
        }
    }; */
    console.log(share_url)
    xhttp.open("GET", `/share/${share_url}`, true);
    xhttp.send();
}
</script>
{% endblock content %}
